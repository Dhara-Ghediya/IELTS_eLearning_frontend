{% extends 'base.html' %}
{% load static %}
{% block content %}

    <!-- Header Start -->
    <div class="container-fluid bg-primary py-5 mb-5 page-header">
        <div class="container py-5">
            <div class="row justify-content-center">
                <div class="col-lg-10 text-center">
                    <h1 class="display-3 text-white animated slideInDown">Writing Test</h1>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb justify-content-center">
                            <li class="breadcrumb-item"><a class="text-white" href="{% url 'home' %}">Home</a></li>
                            <li class="breadcrumb-item"><a class="text-white" href="#">Pages</a></li>
                            <li class="breadcrumb-item text-white active" aria-current="page">Writing Test</li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
    </div>
    <!-- Header End -->
<div> 
    <div style="margin-left: 75%;">Your exam will be submit automatically after... </div>
    <div id="timer-display" style="font-size: 40px; font-weight: bolder; color: black; padding-left: 80%;"></div>
    
	<table class="tab brown hd" style="margin-left: auto; margin-right: auto;">
		<tr><hr>
			<td> <h2> Answer below Questions... </h2> </td>
		</tr>
        
	</table><hr><br>

	<table class="tab" border="0px" style="margin-left: auto; margin-right: auto; margin: 0% 20%;">
		
		<tr>
			<td>
				<form action="" method="post" enctype="multipart/form-data">
					{% csrf_token %}
                    <input type="hidden" name="que_id" value="{{data.0.id}}">

                    <!-- for first question  -->
                    <h3><u>Question1:- </u></h3>
                    <div style="padding: 0% 5% 0% 5%;">
                        <h4>You should spend about 20 minutes on this task.</h4><br>
                            {{data.0.question.question1.content1}} 
                        <br>
                        {% if data.0.question.question1.image is not empty %}
                        <img src="{{media_url}}{{data.0.question.question1.image}}" alt="question image" style="width: 50%; height: 50%;">
                        {% endif %} <br><br>
                        <h4>You should write at least 150 words.</h4>
                        Write Your Answer Here: <br>
                        <textarea name="answer1" cols="150" rows="10" placeholder="Start Writing..." required></textarea> <br><br>
                    </div>

                    <!-- for second Question  -->
                    <h3><u>Question2:- </u></h3>
					<div style="padding: 0% 5% 0% 5%;">
                        <h4>You should spend about 40 minutes on this task.</h4><br>
                        <h6>
                            {{data.0.question.question2.content2}} 
                        </h6><br>
                        <h4>You should write at least 250 words.</h4>
                        Write Your Answer Here: <br>
                        <textarea name="answer2" cols="150" rows="10" placeholder="Start Writing..." required></textarea> <br><br>
                    </div>

					<input type="submit" value="Submit">
				</form>
			</td>
		</tr> 
	</table>
</div>	
 <script>
        // Function to submit the form automatically
        function submitForm() {
            document.querySelector("form").submit();
        }
        // Function to start the timer
        function startTimer(duration, display) {
            var timer = duration, minutes, seconds;
            // Update the timer every second
            var countdown = setInterval(function () {
            minutes = parseInt(timer / 60, 10);
            seconds = parseInt(timer % 60, 10);

            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;

            display.textContent = minutes + ":" + seconds;

            if (--timer < 0) {
                // Timer has ended, submit the form
                clearInterval(countdown);
                submitForm();
            }
            }, 1000);
        }
        
        // Function to validate the answer length before form submission
        function validateAnswer() {
            var answer = document.querySelector("textarea[name='answer']").value;
            var wordCount = answer.split(/\s+/).length;
            if (wordCount < 200) {
            alert("Your answer must be at least 200 words.");
            return false;
            }
            return true;
        }

        // Start the timer when the page is loaded
        window.onload = function () {
            var thirtyMinutes = 60 * 60, // 30 minutes in seconds
            display = document.querySelector("#timer-display");
            startTimer(thirtyMinutes, display);

            var submitButton = document.querySelector("input[type='submit']");
            submitButton.addEventListener("click", function (event) {
            if (!validateAnswer()) {
                event.preventDefault(); // Prevent form submission if validation fails
            }
            });
        };
    </script>
{% endblock content %}